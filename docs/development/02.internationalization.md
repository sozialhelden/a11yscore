# Internationalization

We use Transifex native to manage translations for our project. 

## Architecture

A singleton Transifex native instance is configured via nitro plugin in `src/server/plugins/i18n.ts`. The instance is then passed down via the request context to all middlewares and request/event handlers. The global internationalization middleware (`src/server/middleware/i18n.ts`) gets the requested locale for each request based on the `Accept-Language` header or a `lang` query parameter and passes it down, as well as a preconfigured translation function `t` to request/event handlers via context.

## Usage

This translation function `t` can then be used in request/event handlers to translate strings.

```ts
export default defineCachedEventHandler(async (event) => {
    const t = event.context.t;

    return {
        translatedString: t("This will be translated!"),
    };
});
```

> [!CAUTION]
> Don't use the `t` function from `@transifex/native` directly in request/event handlers, as it won't have the correct locale set for each request.

## Pushing translation strings to Transifex

Make sure the `NITRO_TRANSIFEX_SECRET` environment variable is set correctly in your `.env` file. Then run the following command to push new translation strings to Transifex:

```bash
npm run transifex:sync
```

You can also do a dry-run first to see which strings would be pushed without actually pushing them:

```bashbash
npm run transifex:dry-run
```
