# Getting started

In order to run a11yscore locally, you need to have the following requirements installed on your system:

* [bun](https://bun.sh/) v1.2 or greater
* [docker](https://docs.docker.com/desktop/) and [docker-compose](https://docs.docker.com/compose/install/) or an alternative container runtime that supports compose files

> [!IMPORTANT]
> In order to run this project on your machine properly, you need to access to a Postgres database containing OSM data. Setting up and keeping this database in sync with OSM is not part of this repository. In the future we will provide regular data dumps you can use for that. 

## Set up the project

**1. Clone the repository**
```bash
git clone https://github.com/sozialhelden/a11yscore.git
cd a11yscore
```

**2. Install dependencies**
```bash
bun install
```

**3. Create `.env` file**
```bash
cp .env.example .env
```

**4. Start the database**
```bash
docker-compose up -d
```

**5. Run migrations**
Wait a few moments until the database is fully up and running, then run the migrations:
```bash
bun run db:migrate
```

**6. Start the development server**
```bash
bun run dev
```

**7. Connect to your OSM sync database and calculate scores**
Edit your `.env` file and add proper credentials for your OSM sync database. Make sure you can connect to it. Then sync the admin areas: 

```bash
bun run job:sync-admin-areas
```

⚠️ Make sure to wait until the sync-admin-areas job is shown as completed in the server logs before running the score computation job:

```bash
bun run job:compute-score
```

Now you can open http://localhost:3000 in your browser to see the application running.

## Useful commands

```bash
# check the code for formatting errors
bun run format

# format the code
bun run format:fix

# lint the code
bun run lint

# lint the code and fix auto-fixable errors
bun run lint:fix

# run tests, make sure the development server is running
bun run test

# generate database migrations from schema
bun run db:generate

# run database migrations
bun run db:migrate

# sync the translation strings in the codebase to transifex
bun run transifex:sync
```

## Jobs

You can start some of the jobs locally using npm scripts:

```bash
# sync admin areas from OSM
bun run job:sync-admin-areas

# compute all a11y-scores
bun run job:compute-score
```

## API documentation

Start the dev-server and open http://localhost:3000/ in your browser to view the API documentation.
