# Getting started

In order to run a11yscore locally, you need to have the following requirements installed on your system:

* [nvm](https://github.com/nvm-sh/nvm)
* [docker](https://docs.docker.com/desktop/) and [docker-compose](https://docs.docker.com/compose/install/) or an alternative container runtime that supports compose files

> [!IMPORTANT]
> In order to run this project on your machine properly, you need to access to a Postgres database containing OSM data. Setting up and keeping this database in sync with OSM is not part of this repository. In the future we will provide regular data dumps you can use for that. 

## Set up the project

**1. Clone the repository**
```bash
git clone https://github.com/sozialhelden/a11yscore.git
cd a11yscore
```

**2. Install runtime and dependencies**
```bash
nvm install
npm ci
```

**3. Create `.env` file**
```bash
cp .env.example .env
```

**4. Start the database**
```bash
docker-compose up -d
```

**5. Run migrations**
Wait a few moments until the database is fully up and running, then run the migrations:
```bash
npm run db:migrate
```

**6. Start the development server**
```bash
npm run dev
```

**7. Connect to your OSM sync database and calculate scores**
Edit your `.env` file and add proper credentials for your OSM sync database. Make sure you can connect to it. Then sync the admin areas: 

```bash
npm run job:sync-admin-areas
```

⚠️ Make sure to wait until the sync-admin-areas job is shown as completed in the server logs before running the score computation job:

```bash
npm run job:compute-scores
```

Now you can open http://localhost:3000 in your browser to see the application running.

## Useful commands

```bash
# check the code for formatting errors
npm run format

# format the code
npm run format:fix

# lint the code
npm run lint

# lint the code and fix auto-fixable errors
npm run lint:fix

# run tests, make sure the development server is running
npm run test

# generate database migrations from schema
npm run db:generate

# run database migrations
npm run db:migrate

# sync the translation strings in the codebase to transifex
npm run transifex:sync
```

## Jobs

You can start some of the jobs locally using npm scripts:

```bash
# sync admin areas from OSM
npm run job:sync-admin-areas

# compute all a11y-scores
npm run job:compute-scores

# compute score for a specific admin-area by it's internal id
npm run job:compute-admin-area-score 0276260f-1376-4cf3-8189-aeeb1c9d04f6
```

## API documentation

Start the dev-server and open http://localhost:3000/ in your browser to view the API documentation.
